From 2845d07b1584789a23a0e691ceff476e5d82ccb7 Mon Sep 17 00:00:00 2001
From: Jan Tojnar <jtojnar@gmail.com>
Date: Fri, 14 Dec 2018 20:19:50 +0100
Subject: [PATCH] build: fix DATA_DIR constant
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

On Nix, the datadir option is returning just share, which causes issues when
the program tries to load the data:

$ result/bin/gupnp-network-light
** (gupnp-network-light:29089): CRITICAL **: 20:12:47.920: Unable to load the XML description file: Failed to parse share/gupnp-tools/xml/network-light-desc.xml

Letâ€™s fix it to always use absolute paths.
---
 meson.build | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/meson.build b/meson.build
index 67c61f2..70201ef 100644
--- meson.build
+++ meson.build
@@ -23,21 +23,25 @@ if not gtksourceview.found()
     gtksourceview = dependency('gtksourceview-3.0', version: '>= 3.2.0', required: false)
 endif
 
+prefix = get_option('prefix')
+datadir = join_paths(prefix, get_option('datadir'))
+localedir = join_paths(prefix, get_option('localedir'))
+
 resource_data = join_paths(meson.source_root(), 'data')
 if get_option('uninstalled')
     shareddir = resource_data
 else
-    shareddir = join_paths(get_option('datadir'), meson.project_name())
+    shareddir = join_paths(datadir, meson.project_name())
 endif
 
-desktopdir = join_paths(get_option('datadir'), 'applications')
+desktopdir = join_paths(datadir, 'applications')
 
 conf = configuration_data()
 conf.set('VERSION', '"@0@"'.format(meson.project_version()))
 conf.set('DATA_DIR', '"@0@"'.format(shareddir))
 conf.set('HAVE_GTK_SOURCEVIEW', gtksourceview.found())
 conf.set('GETTEXT_PACKAGE', '"@0@"'.format(meson.project_name()))
-conf.set('LOCALEDIR', '"@0@"'.format(join_paths(get_option('prefix'), get_option('localedir'))))
+conf.set('LOCALEDIR', '"@0@"'.format(localedir))
 
 configure_file(input: 'config.h.meson', output: 'config.h', configuration: conf)
 config_header = declare_dependency(compile_args : '-DHAVE_CONFIG_H=1', include_directories : include_directories('.'))
-- 
2.18.1


